{{!-- Ralph Loop Prompt Template --}}

# {{prdName}}

> {{prdDescription}}

**Progress:** {{prdCompletedCount}} of {{prdTotalCount}} stories complete

**Full PRD:** For complete project context (goals, architecture, testing strategy, all user stories), read the PRD.md file in the same directory as prd.json.

---

{{#if codebasePatterns}}
## Codebase Patterns (Study First)
{{codebasePatterns}}

---
{{/if}}

## Current Task: {{taskId}} - {{taskTitle}}

### Description
{{taskDescription}}

### Acceptance Criteria
{{acceptanceCriteria}}

{{#if notes}}
### Notes
{{notes}}
{{/if}}

{{#if dependsOn}}
### Prerequisites
Requires: **{{dependsOn}}** - Review their outputs in `.ralph-tui/progress.md`
{{/if}}

---

{{#if recentProgress}}
## Recent Progress
{{recentProgress}}

---
{{/if}}

## Workflow

1. Study the PRD context above to understand the bigger picture
2. Study `.ralph-tui/progress.md` for patterns, gotchas, and previous learnings
3. Check if this task's work already exists - if so, verify and signal COMPLETE
4. Implement this single story following acceptance criteria
5. Run quality checks as specified in CLAUDE.md
6. Commit: `feat: {{taskId}} - {{taskTitle}}`
7. Document learnings in `.ralph-tui/progress.md`
8. Signal completion

### Documentation Format
APPEND to `.ralph-tui/progress.md`:
```
## ✓ Iteration N - {{taskId}}: {{taskTitle}}
- What was implemented
- Files changed
- **Learnings:** patterns, gotchas
---
```

---

## Loop Context

You are operating autonomously in a Ralph loop. Each iteration:
- Starts fresh with no memory of previous runs
- Must read `.ralph-tui/progress.md` for context from previous iterations
- Must signal completion to proceed to next task

---

## Completion Signals

**When all acceptance criteria are met:**
```
<promise>COMPLETE</promise>
```

**When blocked and need human input:**
```
<promise>BLOCKED</promise>
Reason: [what you need]
```

**When non-critical task cannot be completed:**
```
<promise>SKIP</promise>
Reason: [why] | Attempted: [what you tried]
```

**When critical failure requires human intervention:**
```
<promise>EJECT</promise>
Reason: [the issue] | Impact: [what's blocked]
```

**Rules:**
- Verify ALL acceptance criteria before signaling COMPLETE
- NEVER signal COMPLETE if tests fail
- If work already exists, verify it meets criteria → COMPLETE immediately
