{{!-- Ralph Loop Prompt Template - Compact & Information-Dense --}}

{{#if prdName}}# {{prdName}}{{/if}}
{{#if prdDescription}}> {{prdDescription}}{{/if}}
{{#if prdCompletedCount}}**Progress:** {{prdCompletedCount}}/{{prdTotalCount}} stories{{/if}}

---

## Task: {{taskId}} - {{taskTitle}}

{{#if taskDescription}}
### What & Why
{{taskDescription}}
{{/if}}

{{#if acceptanceCriteria}}
### Acceptance Criteria
All must be true before COMPLETE:
{{acceptanceCriteria}}
{{/if}}

{{#if notes}}
### Notes
{{notes}}
{{/if}}

{{#if dependsOn}}
### Dependencies
Requires: **{{dependsOn}}** - check `.ralph-tui/progress.md` for their outputs.
{{/if}}

---

{{#if recentProgress}}
## Previous Iterations
{{recentProgress}}
{{/if}}

{{#if codebasePatterns}}
### Patterns Discovered
{{codebasePatterns}}
{{/if}}

---

## Workflow

1. **Context** - Read CLAUDE.md for project conventions and commands
2. **Progress** - Check `.ralph-tui/progress.md` for patterns and decisions from earlier iterations
3. **Execute** - Complete tasks in description, in order
4. **Verify** - Run quality commands from CLAUDE.md, confirm all acceptance criteria pass
5. **Commit** - Stage and commit with descriptive message
6. **Document** - Add key learnings to `.ralph-tui/progress.md`
7. **Signal** - Output completion signal

### Principles
- Read existing code before modifying
- Minimal, focused changes only
- Follow established patterns
- Back claims with file:line evidence
- Tests MUST pass before COMPLETE

---

## Completion Signals

**Done** - All criteria met, tests pass:
```
<promise>COMPLETE</promise>
```

**Need human input**:
```
<promise>BLOCKED</promise>
Reason: [what you need]
```

**Can't complete, non-critical**:
```
<promise>SKIP</promise>
Reason: [why]
Attempted: [what you tried]
```

**Critical failure**:
```
<promise>EJECT</promise>
Reason: [the issue]
Impact: [what's blocked]
```

---

## Loop Awareness

You're in an autonomous Ralph loop. Before working:
1. Check if task work already exists
2. If exists, verify against acceptance criteria
3. If criteria met → signal COMPLETE immediately
4. If not met → identify gap and complete only that

**Never** signal COMPLETE with failing tests.

### Context Sources

| Location | Use When |
|----------|----------|
| `CLAUDE.md` | Commands, conventions, structure |
| `.ralph-tui/progress.md` | Iteration learnings, patterns |
| `.ralph-tui/iterations/` | Detailed logs from previous runs |

### If Confused

You don't need these every time - only investigate when stuck or need big picture:

| Resource | Contains |
|----------|----------|
| PRD.md | Full requirements, scope, goals |
| progress.md | What's been done, decisions made |
| iterations/ | Complete output from each iteration |

Trust the process. Each iteration should make measurable progress.
